<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéÅ Le Tr√©sor Magique ‚Äî Treasure Hub</title>
  <meta name="description" content="Un mini-jeu simple pour partager un lien : d√©couvre ton tr√©sor, g√©n√®re un QR et partage sur WhatsApp !" />

  <!-- Perf / Font (l√©ger) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#f5f9ff;
      --bg2:#c6e6ff;
      --card:#ffffff;
      --accent:#0f6cff;
      --accent-2:#00c2a8;
      --muted:#587199;
      --glass: rgba(255,255,255,0.6);
      --radius:18px;
      --shadow: 0 8px 30px rgba(12, 40, 80, 0.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(160deg,var(--bg1) 0%, var(--bg2) 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      color:#063055;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      min-height:100vh;
    }

    .wrap {
      width:980px;
      max-width:100%;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:28px;
      align-items:center;
    }

    /* Card left (game) */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
      border-radius: var(--radius);
      padding:26px;
      box-shadow: var(--shadow);
      text-align:center;
      position:relative;
      overflow:visible;
    }

    h1{font-size:1.4rem;margin:0 0 8px 0}
    p.lead{margin:0 0 16px 0;color:var(--muted);font-size:0.98rem}

    /* Chest svg container */
    .chest-wrap{display:flex;align-items:center;justify-content:center;margin:6px 0 12px}
    .chest{
      width:180px;height:140px;cursor:pointer;transform-origin:center bottom;transition:transform .28s ease;
    }
    .chest .lid{ transform-origin: 50% 100%; transition: transform .45s cubic-bezier(.2,.9,.3,1) }
    .chest.open .lid{ transform: rotateX( -70deg ) translateY(-6px); }

    .cta-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .btn{
      background:var(--accent); color:#fff; border:none;padding:10px 14px;border-radius:12px;font-weight:600;
      cursor:pointer;font-size:0.95rem;box-shadow: 0 6px 18px rgba(15,108,204,0.12);
    }
    .btn.alt{ background:#fff;color:var(--accent);border:1px solid rgba(15,108,204,0.08) }
    .btn.ghost{ background:transparent;color:var(--accent);border:1px dashed rgba(6,48,85,0.06) }

    #message{ min-height:46px; display:flex;align-items:center;justify-content:center;font-weight:700;color:#0b3d6a }

    .qr-box{ display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:14px }

    .link-preview{
      display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border-radius:12px;background:rgba(3,60,115,0.04);
      font-size:0.9rem;color:#0b3d6a;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
    }

    /* Right panel */
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
      border-radius:var(--radius); padding:20px; box-shadow:var(--shadow);
    }
    .panel h2{margin:0 0 8px 0;font-size:1.05rem}
    .row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    label{font-size:0.85rem;color:var(--muted);min-width:110px}
    input[type="url"]{
      flex:1;padding:10px;border-radius:12px;border:1px solid rgba(6,48,85,0.06);font-size:0.95rem;
      outline:none;background:transparent;
    }
    small.help{display:block;color:var(--muted);margin-top:6px;font-size:0.82rem}

    /* Confetti canvas */
    #confettiCanvas{ position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; display:none; border-radius:var(--radius) }

    footer{ margin-top:14px;color:var(--muted);font-size:0.82rem;text-align:center }

    /* Responsive */
    @media (max-width:880px){
      .wrap{ grid-template-columns:1fr; padding:0 8px }
      .card, .panel{ order:unset }
    }
  </style>
</head>
<body>
  <div class="wrap" role="main" aria-labelledby="mainTitle">
    <!-- Left card: Game -->
    <section class="card" aria-labelledby="gameTitle" id="cardLeft" style="position:relative;overflow:visible;">
      <canvas id="confettiCanvas" aria-hidden="true"></canvas>

      <h1 id="gameTitle">üéÅ Open your treasure</h1>
      <p class="lead">Click on the chest to discover your surprise, specially crafted just for you! üéÅ
Generate the QR code and share it on Threads and Instagram with your friends to receive a personal video call invitation from me! üì±</p>

      <div class="chest-wrap" title="Click to open" aria-hidden="false">
        <!-- Simple SVG coffre : base + lid animable -->
        <svg class="chest" viewBox="0 0 220 180" role="img" aria-label="Coffre au tr√©sor, clique pour ouvrir">
          <!-- base -->
          <g transform="translate(10,20)">
            <rect x="12" y="60" width="180" height="80" rx="10" fill="#7B4B1F"/>
            <rect x="12" y="60" width="180" height="8" fill="#2f1d11"/>
            <rect x="18" y="68" width="168" height="48" rx="8" fill="#C27A2A"/>
            <circle cx="100" cy="92" r="8" fill="#ffd27a"/>
            <!-- lid (separate group for animation) -->
            <g class="lid">
              <rect x="6" y="16" width="196" height="60" rx="12" fill="#8f3f13" stroke="#701f00" stroke-width="2"/>
              <rect x="10" y="20" width="188" height="52" rx="10" fill="#D98432"/>
            </g>
          </g>
        </svg>
      </div>

      <div id="message" aria-live="polite">Tap on the chest to begin</div>

      <div class="qr-box" id="qrBox" style="display:none">
        <div id="qrArea" aria-hidden="false"></div>
        <div class="link-preview" id="shortLink" role="link" tabindex="0"></div>
        <div class="cta-row" role="group" aria-label="Actions">
          <button class="btn" id="openBtn">Ouvrir la surprise</button>
          <button class="btn alt" id="shareBtn">Partager</button>
          <button class="btn ghost" id="copyBtn" title="Copier le lien">Copier</button>
          <button class="btn ghost" id="downloadQr" title="T√©l√©charger le QR">T√©l√©charger QR</button>
        </div>
      </div>

      <footer>Your game ‚Äî Share safely ‚ú®</footer>
    </section>

    <!-- Right panel: Controls -->
    <aside class="panel" aria-label="Param√®tres du tr√©sor">
      <h2>Settings</h2>

      <div class="row">
        <label for="linkInput">Link to share</label>
        <input id="linkInput" type="url" placeholder="https://getmysocial.com/emaxxxwn" value="" />
      </div>

      <div class="row">
        <label for="ttl">Message style</label>
        <select id="styleSelect" aria-label="Choisir le style de message">
          <option value="fun">Fun & emojis</option>
          <option value="pro">Pro (sans emoji)</option>
          <option value="myst">Myst√©rieux</option>
        </select>
      </div>

      <div style="margin-top:6px">
        <small class="help">Replace your link below or click <strong>Open the chest</strong> to use the default link.</small>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px dashed rgba(6,48,85,0.06)"/>
    </aside>
  </div>

  <!-- QRious (lib l√©g√®re pour canvas QR) -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

  <script>
    // --------------------------
    // CONFIG ‚Äî remplace ce lien
    // --------------------------
    const DEFAULT_LINK = "https://getmysocial.com/emaxxxwn"; // ‚Üê change ce lien par le tien avant d√©ploiement

    // Messages selon style
    const MESSAGES = {
      fun: [
        "‚ú® Tu as trouv√© un badge magique !",
        "üéâ Bravo ! Une surprise t'attend !",
        "üåü Chanceux ! Clique pour d√©couvrir !",
        "üíé La perle secr√®te est √† toi !",
        "üéÅ Tr√©sor trouv√© ! Partage pour doubler ta chance !"
      ],
      pro: [
        "Vous avez une nouvelle offre ‚Äî cliquez pour voir.",
        "Acc√®s rapide √† la promotion d√©di√©e.",
        "D√©couvrir la s√©lection du jour.",
        "Offre exclusive ‚Äî ouvert maintenant.",
        "Invitation : cliquez pour en savoir plus."
      ],
      myst: [
        "Quelque chose t'appelle dans l'ombre‚Ä¶",
        "Le secret est √† port√©e de clic.",
        "Ose d√©couvrir ce qui est cach√©.",
        "La cl√© s'ouvre ici. Es-tu pr√™t ?",
        "Un myst√®re t'attend ‚Äî clique."
      ]
    };

    // Elements
    const chest = document.querySelector('.chest');
    const messageEl = document.getElementById('message');
    const qrBox = document.getElementById('qrBox');
    const qrArea = document.getElementById('qrArea');
    const shortLink = document.getElementById('shortLink');
    const openBtn = document.getElementById('openBtn');
    const shareBtn = document.getElementById('shareBtn');
    const copyBtn = document.getElementById('copyBtn');
    const downloadQrBtn = document.getElementById('downloadQr');
    const linkInput = document.getElementById('linkInput');
    const styleSelect = document.getElementById('styleSelect');
    const confettiCanvas = document.getElementById('confettiCanvas');
    const cardLeft = document.getElementById('cardLeft');

    // confetti context setup
    let confettiCtx, confettiParticles = [], confettiAnimating = false;
    function setupConfetti(){
      confettiCanvas.width = cardLeft.clientWidth;
      confettiCanvas.height = cardLeft.clientHeight;
      confettiCanvas.style.display = 'none';
      confettiCtx = confettiCanvas.getContext('2d');
    }
    window.addEventListener('resize', ()=>{ setupConfetti() });

    // simple confetti (lightweight)
    function launchConfetti(){
      confettiParticles = [];
      const w = confettiCanvas.width, h = confettiCanvas.height;
      for(let i=0;i<45;i++){
        confettiParticles.push({
          x: w/2 + (Math.random()*220-110),
          y: h/3 + Math.random()*40 - 30,
          vx: (Math.random()-0.5)*4,
          vy: -Math.random()*4 - 2,
          size: Math.random()*7+4,
          color: ["#FFD66B","#FF6B6B","#6BF0C4","#6BB7FF","#D36BFF"][Math.floor(Math.random()*5)],
          rot: Math.random()*360,
          rotSpeed: Math.random()*8-4,
          life: 120 + Math.random()*40
        });
      }
      confettiCanvas.style.display = 'block';
      confettiAnimating = true;
      requestAnimationFrame(confettiLoop);
    }
    function confettiLoop(){
      if(!confettiAnimating) return;
      confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      for(let i=0;i<confettiParticles.length;i++){
        const p = confettiParticles[i];
        p.vy += 0.15; p.x += p.vx; p.y += p.vy; p.rot += p.rotSpeed; p.life--;
        confettiCtx.save();
        confettiCtx.translate(p.x,p.y);
        confettiCtx.rotate(p.rot*Math.PI/180);
        confettiCtx.fillStyle = p.color;
        confettiCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
        confettiCtx.restore();
      }
      confettiParticles = confettiParticles.filter(p=>p.life>0 && p.y < confettiCanvas.height+30);
      if(confettiParticles.length>0) requestAnimationFrame(confettiLoop);
      else { confettiAnimating=false; confettiCanvas.style.display='none'; }
    }

    // Helper: pick message
    function pickMessage(style){
      const arr = MESSAGES[style] || MESSAGES.fun;
      return arr[Math.floor(Math.random()*arr.length)];
    }

    // generate QR using QRious (canvas)
    let qr; // QRious instance
    function generateQR(link){
      // clear old
      qrArea.innerHTML = '';
      const canvas = document.createElement('canvas');
      canvas.id = 'qrCanvas';
      canvas.setAttribute('aria-hidden','true');
      qrArea.appendChild(canvas);
      qr = new QRious({ element: canvas, value: link, size: 220, level: 'H' });
      shortLink.textContent = link;
      shortLink.setAttribute('title', link);
      shortLink.onclick = ()=>{ window.open(link,'_blank') };
    }

    // open treasure actions
    function openTreasure(){
      const link = (linkInput.value && linkInput.value.trim()) ? linkInput.value.trim() : DEFAULT_LINK;
      const style = styleSelect.value || 'fun';
      // animate chest
      chest.classList.add('open');
      // set message and show QR
      const text = pickMessage(style);
      messageEl.textContent = text;
      generateQR(link);
      qrBox.style.display = 'flex';
      // show confetti
      launchConfetti();
      // small pulse on message
      messageEl.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:600,easing:'ease-out'});
    }

    // share actions
    async function doShare(){
      const link = (linkInput.value && linkInput.value.trim()) ? linkInput.value.trim() : DEFAULT_LINK;
      const shareText = "J'ai trouv√© un tr√©sor ! üéÅ D√©couvre-le ici: " + link;
      // prefer native Web Share API
      if(navigator.share){
        try{
          await navigator.share({ title:'Tr√©sor magique', text: shareText, url: link });
          return;
        }catch(e){
          /* user cancelled or not available - fallback below */
        }
      }
      // fallback: open WhatsApp share
      const wa = "https://wa.me/?text=" + encodeURIComponent(shareText);
      window.open(wa,'_blank','noopener');
    }

    // copy link
    async function copyLink(){
      const link = (linkInput.value && linkInput.value.trim()) ? linkInput.value.trim() : DEFAULT_LINK;
      try{
        await navigator.clipboard.writeText(link);
        const prev = copyBtn.textContent;
        copyBtn.textContent = "Copi√© ‚úì";
        setTimeout(()=>copyBtn.textContent = prev,1200);
      }catch(e){
        // fallback open prompt
        window.prompt("Copie le lien ci-dessous :", link);
      }
    }

    // download QR as PNG
    function downloadQR(){
      const canvas = document.getElementById('qrCanvas');
      if(!canvas){ alert("QR non g√©n√©r√©."); return; }
      const dataUrl = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = 'treasure-qr.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    // open the target link
    function openTarget(){
      const link = (linkInput.value && linkInput.value.trim()) ? linkInput.value.trim() : DEFAULT_LINK;
      window.open(link,'_blank','noopener');
    }

    // On chest click -> open
    document.addEventListener('DOMContentLoaded', ()=>{
      setupConfetti();

      // Prefill linkInput with default for convenience
      linkInput.value = DEFAULT_LINK;

      // allow clicking the chest svg anywhere
      document.querySelector('.chest-wrap').addEventListener('click', openTreasure);
      // also allow keyboard activation
      document.querySelector('.chest-wrap').addEventListener('keypress', (e)=>{
        if(e.key === 'Enter' || e.key === ' ') openTreasure();
      });

      // wire up buttons
      shareBtn.addEventListener('click', doShare);
      copyBtn.addEventListener('click', copyLink);
      downloadQrBtn.addEventListener('click', downloadQR);
      openBtn.addEventListener('click', openTarget);

      // small accessibility: press Enter on shortLink to open
      shortLink.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openTarget(); });

      // allow pressing Enter key in the input to trigger open
      linkInput.addEventListener('keyup',(e)=>{ if(e.key === 'Enter') openTreasure() });

      // on load, hide QR box until opened
      qrBox.style.display = 'none';
    });
  </script>
</body>
</html>